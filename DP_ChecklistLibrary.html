<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DP's Checklists</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 0;
        }

        .container-fluid {
            max-width: 1400px;
        }

        .header-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .header-section h1 {
            color: white;
            font-weight: 700;
            margin-bottom: 15px;
            text-align: center;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header-section p {
            color: rgba(255, 255, 255, 0.9);
            text-align: center;
            font-size: 1.1rem;
        }

        .controls-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .checklists-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }

        .checklist-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            animation: fadeInUp 0.6s ease forwards;
        }

        .checklist-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .checklist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .checklist-title {
            color: white;
            font-weight: 600;
            font-size: 1.3rem;
            margin: 0;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .checklist-actions {
            display: flex;
            gap: 8px;
        }

        .checklist-progress {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .checklist-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .checklist-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .checklist-item.completed {
            background: rgba(76, 175, 80, 0.2);
            border-color: rgba(76, 175, 80, 0.3);
        }

        .checklist-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #4caf50;
        }

        .checklist-item-text {
            flex: 1;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
            transition: all 0.2s ease;
        }

        .checklist-item.completed .checklist-item-text {
            text-decoration: line-through;
            opacity: 0.7;
        }

        .btn-custom {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 10px;
            padding: 8px 16px;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
        }

        .btn-custom:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            color: white;
            transform: translateY(-2px);
        }

        .btn-primary-custom {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            border: none;
            color: white;
            font-weight: 600;
        }

        .btn-primary-custom:hover {
            background: linear-gradient(45deg, #3d8bfe 0%, #00c4fe 100%);
            transform: translateY(-2px);
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
        }

        .form-control, .form-select {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        .form-control:focus, .form-select:focus {
            background: rgba(255, 255, 255, 1);
            border-color: #4facfe;
            box-shadow: 0 0 0 0.2rem rgba(79, 172, 254, 0.25);
        }

        .btn-header-icon {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 10px;
            padding: 12px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            position: relative;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-header-icon:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            color: white;
            transform: translateY(-2px);
            width: auto;
            padding: 12px 16px;
        }

        .btn-header-icon .btn-text {
            display: none;
            margin-left: 8px;
            white-space: nowrap;
            font-size: 0.9rem;
        }

        .btn-header-icon:hover .btn-text {
            display: inline;
        }

        .btn-header-icon i {
            font-size: 1.1rem;
        }



        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: rgba(255, 255, 255, 0.8);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Header Section -->
        <div class="header-section">
            <div class="d-flex justify-content-between align-items-center">
                <h1><i class="bi bi-check2-square me-3"></i>DP's Checklists</h1>
                <div class="d-flex gap-2">
                    <button class="btn btn-header-icon" onclick="showAddChecklistModal()" title="Add Checklist">
                        <i class="bi bi-plus-lg"></i>
                        <span class="btn-text">Add Checklist</span>
                    </button>
                    <button class="btn btn-header-icon" onclick="loadChecklists()" title="Refresh">
                        <i class="bi bi-arrow-clockwise"></i>
                        <span class="btn-text">Refresh</span>
                    </button>
                </div>
            </div>
        </div>



        <!-- Checklists Container -->
        <div class="checklists-container" id="checklistsContainer">
            <div class="empty-state">
                <i class="bi bi-clipboard-x"></i>
                <h3>No Checklists Yet</h3>
                <p>Click "Add Checklist" to create your first checklist</p>
            </div>
        </div>
    </div>

    <!-- Add/Edit Checklist Modal -->
    <div class="modal fade" id="checklistModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Add New Checklist</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="checklistForm">
                        <div class="mb-3">
                            <label for="checklistTitle" class="form-label">Checklist Title</label>
                            <input type="text" class="form-control" id="checklistTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="checklistDescription" class="form-label">Description (Optional)</label>
                            <textarea class="form-control" id="checklistDescription" rows="2"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Checklist Items</label>
                            <div id="itemsContainer">
                                <div class="input-group mb-2">
                                    <input type="text" class="form-control" placeholder="Enter checklist item">
                                    <button class="btn btn-outline-secondary" type="button" onclick="removeItem(this)">
                                        <i class="bi bi-dash"></i>
                                    </button>
                                </div>
                            </div>
                            <button type="button" class="btn btn-outline-primary btn-sm" onclick="addNewItem()">
                                <i class="bi bi-plus me-1"></i>Add Item
                            </button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveChecklist()">Save Checklist</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let checklists = [];
        let editingChecklistId = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadChecklists();
        });

        // Data management functions
        function loadChecklists() {
            fetch('MyChecklistsCollection.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('JSON file not found');
                    }
                    return response.json();
                })
                .then(data => {
                    parseChecklistsData(data);
                    renderChecklists();
                })
                .catch(error => {
                    console.log('No JSON file found or error loading:', error);
                    checklists = [];
                    renderChecklists();
                });
        }

        function parseChecklistsData(data) {
            if (!data.checklists || !Array.isArray(data.checklists)) {
                checklists = [];
                return;
            }

            checklists = data.checklists.map((checklist, index) => {
                const items = checklist.Items.map((itemText, itemIndex) => ({
                    id: `${index}_${itemIndex}`,
                    text: itemText,
                    completed: false // Always start fresh, no state preservation
                }));

                return {
                    id: `checklist_${index}`,
                    title: checklist.ChecklistName,
                    description: checklist.ChecklistDescription || '',
                    items: items,
                    createdDate: new Date().toISOString(),
                    lastModified: new Date().toISOString()
                };
            });
        }

        function saveDataToJSON() {
            const jsonData = {
                checklists: checklists.map(checklist => ({
                    ChecklistName: checklist.title,
                    ChecklistDescription: checklist.description,
                    Items: checklist.items.map(item => item.text)
                }))
            };
            return JSON.stringify(jsonData, null, 2);
        }

        function downloadJSONFile() {
            const jsonContent = saveDataToJSON();
            const blob = new Blob([jsonContent], { type: 'application/json;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'MyChecklistsCollection.json');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Checklist management functions
        function showAddChecklistModal() {
            editingChecklistId = null;
            document.getElementById('modalTitle').textContent = 'Add New Checklist';
            document.getElementById('checklistTitle').value = '';
            document.getElementById('checklistDescription').value = '';
            
            // Reset items container with one empty item
            const itemsContainer = document.getElementById('itemsContainer');
            itemsContainer.innerHTML = `
                <div class="input-group mb-2">
                    <input type="text" class="form-control" placeholder="Enter checklist item">
                    <button class="btn btn-outline-secondary" type="button" onclick="removeItem(this)">
                        <i class="bi bi-dash"></i>
                    </button>
                </div>
            `;
            
            new bootstrap.Modal(document.getElementById('checklistModal')).show();
        }

        function editChecklist(id) {
            const checklist = checklists.find(c => c.id === id);
            if (!checklist) return;

            editingChecklistId = id;
            document.getElementById('modalTitle').textContent = 'Edit Checklist';
            document.getElementById('checklistTitle').value = checklist.title;
            document.getElementById('checklistDescription').value = checklist.description || '';
            
            // Populate items
            const itemsContainer = document.getElementById('itemsContainer');
            itemsContainer.innerHTML = '';
            checklist.items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'input-group mb-2';
                itemDiv.innerHTML = `
                    <input type="text" class="form-control" placeholder="Enter checklist item" value="${item.text}">
                    <button class="btn btn-outline-secondary" type="button" onclick="removeItem(this)">
                        <i class="bi bi-dash"></i>
                    </button>
                `;
                itemsContainer.appendChild(itemDiv);
            });

            // Add one empty item if no items exist
            if (checklist.items.length === 0) {
                addNewItem();
            }

            new bootstrap.Modal(document.getElementById('checklistModal')).show();
        }

        function saveChecklist() {
            const title = document.getElementById('checklistTitle').value.trim();
            const description = document.getElementById('checklistDescription').value.trim();
            
            if (!title) {
                alert('Please enter a checklist title');
                return;
            }

            // Collect items
            const itemInputs = document.querySelectorAll('#itemsContainer .form-control');
            const items = Array.from(itemInputs)
                .map(input => input.value.trim())
                .filter(text => text.length > 0)
                .map(text => ({
                    id: generateId(),
                    text: text,
                    completed: false
                }));

            if (items.length === 0) {
                alert('Please add at least one checklist item');
                return;
            }

            if (editingChecklistId) {
                // Update existing checklist
                const checklistIndex = checklists.findIndex(c => c.id === editingChecklistId);
                if (checklistIndex !== -1) {
                    checklists[checklistIndex] = {
                        ...checklists[checklistIndex],
                        title: title,
                        description: description,
                        items: items,
                        lastModified: new Date().toISOString()
                    };
                }
            } else {
                // Create new checklist
                const newChecklist = {
                    id: generateId(),
                    title: title,
                    description: description,
                    items: items,
                    createdDate: new Date().toISOString(),
                    lastModified: new Date().toISOString()
                };
                checklists.push(newChecklist);
            }

            downloadJSONFile();
            renderChecklists();
            
            bootstrap.Modal.getInstance(document.getElementById('checklistModal')).hide();
        }

        function deleteChecklist(id) {
            if (confirm('Are you sure you want to delete this checklist?')) {
                checklists = checklists.filter(c => c.id !== id);
                downloadJSONFile();
                renderChecklists();
            }
        }

        function addNewItem() {
            const itemsContainer = document.getElementById('itemsContainer');
            const itemDiv = document.createElement('div');
            itemDiv.className = 'input-group mb-2';
            itemDiv.innerHTML = `
                <input type="text" class="form-control" placeholder="Enter checklist item">
                <button class="btn btn-outline-secondary" type="button" onclick="removeItem(this)">
                    <i class="bi bi-dash"></i>
                </button>
            `;
            itemsContainer.appendChild(itemDiv);
        }

        function removeItem(button) {
            const itemsContainer = document.getElementById('itemsContainer');
            if (itemsContainer.children.length > 1) {
                button.parentElement.remove();
            } else {
                alert('At least one item is required');
            }
        }

        // Checkbox management functions
        function toggleChecklistItem(checklistId, itemId) {
            const checklist = checklists.find(c => c.id === checklistId);
            if (!checklist) return;

            const item = checklist.items.find(i => i.id === itemId);
            if (!item) return;

            item.completed = !item.completed;
            
            // Update only the specific checkbox and its parent item, not the entire page
            updateChecklistItemDisplay(checklistId, itemId);
            updateChecklistProgress(checklistId);
        }

        function updateChecklistItemDisplay(checklistId, itemId) {
            const checkbox = document.querySelector(`input[onchange*="${checklistId}"][onchange*="${itemId}"]`);
            if (!checkbox) return;

            const item = checklists.find(c => c.id === checklistId)?.items.find(i => i.id === itemId);
            if (!item) return;

            const checklistItem = checkbox.closest('.checklist-item');
            
            // Update checkbox state
            checkbox.checked = item.completed;
            
            // Update item styling
            if (item.completed) {
                checklistItem.classList.add('completed');
            } else {
                checklistItem.classList.remove('completed');
            }
        }

        function updateChecklistProgress(checklistId) {
            const checklist = checklists.find(c => c.id === checklistId);
            if (!checklist) return;

            const completedItems = checklist.items.filter(item => item.completed).length;
            const totalItems = checklist.items.length;
            const progressPercentage = totalItems > 0 ? (completedItems / totalItems) * 100 : 0;
            const isCompleted = completedItems === totalItems && totalItems > 0;

            // Find the checklist card
            const checklistCard = document.querySelector(`[onclick*="${checklistId}"]`)?.closest('.checklist-card');
            if (!checklistCard) return;

            // Update progress bar
            const progressBar = checklistCard.querySelector('.checklist-progress-bar');
            if (progressBar) {
                progressBar.style.width = `${progressPercentage}%`;
            }

            // Update progress text
            const progressText = checklistCard.querySelector('[style*="font-size: 0.9rem"]');
            if (progressText) {
                progressText.innerHTML = `Progress: ${completedItems}/${totalItems} items completed ${isCompleted ? 'ðŸŽ‰' : ''}`;
            }
        }

        // Rendering functions
        function renderChecklists() {
            const container = document.getElementById('checklistsContainer');
            
            if (checklists.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-clipboard-x"></i>
                        <h3>No Checklists Available</h3>
                        <p>Click "Refresh" to reload from JSON file<br>or "Add Checklist" to create a new one</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = checklists.map(checklist => {
                const completedItems = checklist.items.filter(item => item.completed).length;
                const totalItems = checklist.items.length;
                const progressPercentage = totalItems > 0 ? (completedItems / totalItems) * 100 : 0;
                const isCompleted = completedItems === totalItems && totalItems > 0;

                return `
                    <div class="checklist-card" style="animation-delay: ${checklists.indexOf(checklist) * 0.1}s">
                        <div class="checklist-header">
                            <h3 class="checklist-title">${checklist.title}</h3>
                            <div class="checklist-actions">
                                <button class="btn btn-custom btn-sm" onclick="editChecklist('${checklist.id}')" title="Edit">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-custom btn-sm" onclick="deleteChecklist('${checklist.id}')" title="Delete">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        ${checklist.description ? `<p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 15px;">${checklist.description}</p>` : ''}
                        
                        <div class="checklist-progress">
                            <div class="checklist-progress-bar" style="width: ${progressPercentage}%"></div>
                        </div>
                        
                        <div style="color: rgba(255, 255, 255, 0.8); margin-bottom: 20px; font-size: 0.9rem;">
                            Progress: ${completedItems}/${totalItems} items completed ${isCompleted ? 'ðŸŽ‰' : ''}
                        </div>
                        
                        <div class="checklist-items">
                            ${checklist.items.map(item => `
                                <div class="checklist-item ${item.completed ? 'completed' : ''}">
                                    <input type="checkbox" ${item.completed ? 'checked' : ''} 
                                           onchange="toggleChecklistItem('${checklist.id}', '${item.id}')">
                                    <span class="checklist-item-text">${item.text}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }
    </script>
</body>
</html>
